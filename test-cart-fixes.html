<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart Functionality Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="assets/css/cart.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .product { border: 1px solid #ddd; padding: 15px; margin: 10px; display: inline-block; width: 300px; }
        .test-section { margin: 30px 0; }
        h2 { color: #333; border-bottom: 2px solid #FC5F49; padding-bottom: 10px; }
    </style>
</head>
<body>
    <h1>Cart Functionality Testing</h1>
    
    <div class="test-section">
        <h2>Test Products with Color Variants</h2>
        
        <div class="product">
            <h3>T-Shirt - Red</h3>
            <img src="https://via.placeholder.com/150" alt="Red T-Shirt" style="width: 100%; height: 150px; object-fit: cover;">
            <p>Price: $29.99</p>
            <button class="ecommerce-add-to-cart-btn"
                    data-product-id="1"
                    data-product-name="Premium T-Shirt"
                    data-product-price="29.99"
                    data-product-image="https://via.placeholder.com/150"
                    data-variant-id="101"
                    data-variant-color-id="1"
                    data-variant-color-name="Red"
                    data-product-quantity="1">
                Add Red T-Shirt to Cart
            </button>
        </div>
        
        <div class="product">
            <h3>T-Shirt - Blue</h3>
            <img src="https://via.placeholder.com/150/0000FF" alt="Blue T-Shirt" style="width: 100%; height: 150px; object-fit: cover;">
            <p>Price: $29.99</p>
            <button class="ecommerce-add-to-cart-btn"
                    data-product-id="1"
                    data-product-name="Premium T-Shirt"
                    data-product-price="29.99"
                    data-product-image="https://via.placeholder.com/150/0000FF"
                    data-variant-id="102"
                    data-variant-color-id="2"
                    data-variant-color-name="Blue"
                    data-product-quantity="1">
                Add Blue T-Shirt to Cart
            </button>
        </div>
        
        <div class="product">
            <h3>Jeans - Black</h3>
            <img src="https://via.placeholder.com/150/000000" alt="Black Jeans" style="width: 100%; height: 150px; object-fit: cover;">
            <p>Price: $59.99</p>
            <button class="ecommerce-add-to-cart-btn"
                    data-product-id="2"
                    data-product-name="Premium Jeans"
                    data-product-price="59.99"
                    data-product-image="https://via.placeholder.com/150/000000"
                    data-variant-id="201"
                    data-variant-color-id="3"
                    data-variant-color-name="Black"
                    data-product-quantity="1">
                Add Black Jeans to Cart
            </button>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="testMultipleColors()" style="margin: 5px; padding: 10px;">Test: Add Same Product, Different Colors</button>
        <button onclick="testClearCart()" style="margin: 5px; padding: 10px;">Test: Clear Cart (SweetAlert)</button>
        <button onclick="testEmptyCartCheckout()" style="margin: 5px; padding: 10px;">Test: Empty Cart Checkout</button>
        <button onclick="showCartContents()" style="margin: 5px; padding: 10px;">Show Cart Contents</button>
        <button onclick="simulateOrderCompletion()" style="margin: 5px; padding: 10px;">Simulate Order Completion</button>
    </div>
    
    <div class="test-section">
        <h2>Expected Results</h2>
        <ul>
            <li>✅ Same product with different colors should appear as separate items</li>
            <li>✅ Cart should clear after "order completion"</li>
            <li>✅ SweetAlert should be used instead of basic alerts</li>
            <li>✅ Cart should maintain color information</li>
            <li>✅ No duplicate items for same product-color combination</li>
        </ul>
    </div>

    <!-- Cart Sidebar (from your existing components) -->
    <div class="ecommerce-cart-backdrop" id="ecommerceCartBackdrop"></div>
    
    <!-- Include necessary components -->
    @include('web.shop.partials.cart-sidebar')
    @include('web.shop.partials.floating-cart')

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/cart.js"></script>
    
    <script>
        function testMultipleColors() {
            // Add red t-shirt
            window.ecommerceCartManager.addItem({
                id: "1-variant-101",
                name: "Premium T-Shirt (Red)",
                price: 29.99,
                image: "https://via.placeholder.com/150",
                quantity: 1,
                variant_id: "101",
                variant_color_id: "1",
                variant_color_name: "Red",
                base_product_id: "1"
            });
            
            // Add blue t-shirt (same base product, different color)
            setTimeout(() => {
                window.ecommerceCartManager.addItem({
                    id: "1-variant-102",
                    name: "Premium T-Shirt (Blue)",
                    price: 29.99,
                    image: "https://via.placeholder.com/150/0000FF",
                    quantity: 1,
                    variant_id: "102",
                    variant_color_id: "2",
                    variant_color_name: "Blue",
                    base_product_id: "1"
                });
            }, 500);
        }
        
        function testClearCart() {
            window.ecommerceCartManager.handleClearCart();
        }
        
        function testEmptyCartCheckout() {
            // Clear cart first, then try checkout
            window.ecommerceCartManager.cart = [];
            window.ecommerceCartManager.saveCart();
            window.ecommerceCartManager.updateCartDisplay();
            window.ecommerceCartManager.handleCheckout();
        }
        
        function showCartContents() {
            const cart = window.ecommerceCartManager.getCart();
            console.log('Current cart contents:', cart);
            
            if (typeof Swal !== 'undefined') {
                const cartHtml = cart.length > 0 
                    ? cart.map(item => `
                        <div style="text-align: left; margin: 10px 0; padding: 10px; border: 1px solid #ddd;">
                            <strong>${item.name}</strong><br>
                            Color: ${item.variant_color_name || 'N/A'}<br>
                            Price: $${item.price}<br>
                            Quantity: ${item.quantity}<br>
                            Unique ID: ${item.unique_id || item.id}
                        </div>
                    `).join('')
                    : '<p>Cart is empty</p>';
                
                Swal.fire({
                    title: 'Cart Contents',
                    html: cartHtml,
                    confirmButtonText: 'OK'
                });
            } else {
                alert('Cart items: ' + cart.length);
            }
        }
        
        function simulateOrderCompletion() {
            // Simulate successful order
            if (window.ecommerceCartManager.cart.length === 0) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Items',
                    text: 'Add some items to cart first!'
                });
                return;
            }
            
            Swal.fire({
                icon: 'success',
                title: 'Order Successful!',
                text: 'Cart will be cleared now.',
                confirmButtonText: 'OK'
            }).then(() => {
                window.ecommerceCartManager.clearCartAfterOrder();
            });
        }
        
        // Wait for cart manager to initialize
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                console.log('Cart manager initialized:', window.ecommerceCartManager ? 'Yes' : 'No');
                console.log('SweetAlert available:', typeof Swal !== 'undefined' ? 'Yes' : 'No');
            }, 1000);
        });
    </script>
</body>
</html>
